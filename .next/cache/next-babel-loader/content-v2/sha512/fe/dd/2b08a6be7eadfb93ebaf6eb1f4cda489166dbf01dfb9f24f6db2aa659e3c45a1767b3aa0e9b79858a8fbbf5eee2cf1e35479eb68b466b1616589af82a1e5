{"ast":null,"code":"import _regeneratorRuntime from \"/Users/thejmdw/workspace/websites/next-commerce-test/node_modules/@babel/runtime/regenerator\";\nimport _defineProperty from \"/Users/thejmdw/workspace/websites/next-commerce-test/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"/Users/thejmdw/workspace/websites/next-commerce-test/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nvar fetchAllProducts = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(_ref) {\n    var _data$products$edges, _data$products, _data$products2, _data$products2$pageI;\n\n    var config, query, variables, _ref$acc, acc, cursor, _yield$config$fetch, data, edges, hasNextPage, _edges$pop, _cursor;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            config = _ref.config, query = _ref.query, variables = _ref.variables, _ref$acc = _ref.acc, acc = _ref$acc === void 0 ? [] : _ref$acc, cursor = _ref.cursor;\n            _context.next = 3;\n            return config.fetch(query, {\n              variables: _objectSpread(_objectSpread({}, variables), {}, {\n                cursor: cursor\n              })\n            });\n\n          case 3:\n            _yield$config$fetch = _context.sent;\n            data = _yield$config$fetch.data;\n            edges = (_data$products$edges = (_data$products = data.products) === null || _data$products === void 0 ? void 0 : _data$products.edges) !== null && _data$products$edges !== void 0 ? _data$products$edges : [];\n            hasNextPage = (_data$products2 = data.products) === null || _data$products2 === void 0 ? void 0 : (_data$products2$pageI = _data$products2.pageInfo) === null || _data$products2$pageI === void 0 ? void 0 : _data$products2$pageI.hasNextPage;\n            acc = acc.concat(edges);\n\n            if (!hasNextPage) {\n              _context.next = 12;\n              break;\n            }\n\n            _cursor = (_edges$pop = edges.pop()) === null || _edges$pop === void 0 ? void 0 : _edges$pop.cursor;\n\n            if (!_cursor) {\n              _context.next = 12;\n              break;\n            }\n\n            return _context.abrupt(\"return\", fetchAllProducts({\n              config: config,\n              query: query,\n              variables: variables,\n              acc: acc,\n              cursor: _cursor\n            }));\n\n          case 12:\n            return _context.abrupt(\"return\", acc);\n\n          case 13:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function fetchAllProducts(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\nexport default fetchAllProducts;","map":{"version":3,"sources":["/Users/thejmdw/workspace/websites/next-commerce-test/framework/shopify/api/utils/fetch-all-products.ts"],"names":["fetchAllProducts","config","query","variables","acc","cursor","fetch","data","edges","products","hasNextPage","pageInfo","concat","pop"],"mappings":";;;;;;;;AAGA,IAAMA,gBAAgB;AAAA,uEAAG;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;AACvBC,YAAAA,MADuB,QACvBA,MADuB,EAEvBC,KAFuB,QAEvBA,KAFuB,EAGvBC,SAHuB,QAGvBA,SAHuB,kBAIvBC,GAJuB,EAIvBA,GAJuB,yBAIjB,EAJiB,aAKvBC,MALuB,QAKvBA,MALuB;AAAA;AAAA,mBAaAJ,MAAM,CAACK,KAAP,CAAaJ,KAAb,EAAoB;AACzCC,cAAAA,SAAS,kCAAOA,SAAP;AAAkBE,gBAAAA,MAAM,EAANA;AAAlB;AADgC,aAApB,CAbA;;AAAA;AAAA;AAafE,YAAAA,IAbe,uBAafA,IAbe;AAiBjBC,YAAAA,KAjBiB,6CAiBMD,IAAI,CAACE,QAjBX,mDAiBM,eAAeD,KAjBrB,uEAiB8B,EAjB9B;AAkBjBE,YAAAA,WAlBiB,sBAkBHH,IAAI,CAACE,QAlBF,6EAkBH,gBAAeE,QAlBZ,0DAkBH,sBAAyBD,WAlBtB;AAmBvBN,YAAAA,GAAG,GAAGA,GAAG,CAACQ,MAAJ,CAAWJ,KAAX,CAAN;;AAnBuB,iBAqBnBE,WArBmB;AAAA;AAAA;AAAA;;AAsBfL,YAAAA,OAtBe,iBAsBNG,KAAK,CAACK,GAAN,EAtBM,+CAsBN,WAAaR,MAtBP;;AAAA,iBAuBjBA,OAvBiB;AAAA;AAAA;AAAA;;AAAA,6CAwBZL,gBAAgB,CAAC;AACtBC,cAAAA,MAAM,EAANA,MADsB;AAEtBC,cAAAA,KAAK,EAALA,KAFsB;AAGtBC,cAAAA,SAAS,EAATA,SAHsB;AAItBC,cAAAA,GAAG,EAAHA,GAJsB;AAKtBC,cAAAA,MAAM,EAANA;AALsB,aAAD,CAxBJ;;AAAA;AAAA,6CAkChBD,GAlCgB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAH;;AAAA,kBAAhBJ,gBAAgB;AAAA;AAAA;AAAA,GAAtB;;AAqCA,eAAeA,gBAAf","sourcesContent":["import { ProductEdge } from '../../schema'\nimport { ShopifyConfig } from '..'\n\nconst fetchAllProducts = async ({\n  config,\n  query,\n  variables,\n  acc = [],\n  cursor,\n}: {\n  config: ShopifyConfig\n  query: string\n  acc?: ProductEdge[]\n  variables?: any\n  cursor?: string\n}): Promise<ProductEdge[]> => {\n  const { data } = await config.fetch(query, {\n    variables: { ...variables, cursor },\n  })\n\n  const edges: ProductEdge[] = data.products?.edges ?? []\n  const hasNextPage = data.products?.pageInfo?.hasNextPage\n  acc = acc.concat(edges)\n\n  if (hasNextPage) {\n    const cursor = edges.pop()?.cursor\n    if (cursor) {\n      return fetchAllProducts({\n        config,\n        query,\n        variables,\n        acc,\n        cursor,\n      })\n    }\n  }\n\n  return acc\n}\n\nexport default fetchAllProducts\n"]},"metadata":{},"sourceType":"module"}